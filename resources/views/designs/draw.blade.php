@extends('layouts.main')

@section('title','DST Kirajzolás')

@section('content')
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Színválasztás</h3>
                </div>
                <form action="{{ route('designs.colors', ['design' => $design]) }}" method="POST">
                    {{ csrf_field() }}
                    <input type="hidden" name="colors" value="{{ $color_count }}">
                    <input type="hidden" name="diameter" value="{{ $diameter }}">
                    <input type="hidden" name="xoffset" value="{{ abs($minx) }}">
                    <input type="hidden" name="yoffset" value="{{ abs($miny) }}">
                    <input type="hidden" name="height" value="{{ $height }}">
                    <input type="hidden" name="width" value="{{ $width }}">
                    <div class="panel-body">
                        <div class="color-select">
                            @if($design->colors->count()==0)
                            @for($i = 0; $i<$color_count; $i++)
                                <input type="hidden" name="color_stitches_{{ $i }}" value="{{ sizeof($stitches[$i]) }}">
                                <input type="hidden" name="r_{{ $i }}" id="r_{{ $i }}" value="">
                                <input type="hidden" name="g_{{ $i }}" id="g_{{ $i }}" value="">
                                <input type="hidden" name="b_{{ $i }}" id="b_{{ $i }}" value="">
                                <div class="color">
                                    {{ $i+1 }}. szín:
                                    <label id="color_isa_{{ $i }}"><input checked name="color_isa_{{ $i }}" type="radio" value="isa"> Isacord</label>
                                    <label id="color_sulky_{{ $i }}"><input name="color_isa_{{ $i }}" type="radio" value="sulky"> Sulky</label>
                                    <input type="text" class="form-control" name="color_{{ $i }}" placeholder="Színkód" id="icolor_{{ $i }}">
                                </div>
                            @endfor
                            @else
                                <?php $i = 0; ?>
                                @foreach($design->colors as $color)
                                    <input type="hidden" name="color_stitches_{{ $i }}" value="{{ sizeof($stitches[$i]) }}">
                                    <input type="hidden" name="r_{{ $i }}" id="r_{{ $i }}" value="{{ $color->red }}">
                                    <input type="hidden" name="g_{{ $i }}" id="g_{{ $i }}" value="{{ $color->green }}">
                                    <input type="hidden" name="b_{{ $i }}" id="b_{{ $i }}" value="{{ $color->blue }}">
                                        <div class="color">
                                            <?= $i+1 ?>. szín:
                                            <label id="color_isa_<?= $i ?>>"><input {{ $color->isacord ? "checked" : "" }} name="color_isa_<?= $i ?>" type="radio" value="isa"> Isacord</label>
                                            <label id="color_sulky_<?= $i ?>"><input {{ $color->isacord ? "" : "checked" }} name="color_isa_<?= $i ?>" type="radio" value="sulky"> Sulky</label>
                                            <input value="{{ $color->code }}" type="text" class="form-control" name="color_<?= $i ?>" placeholder="Színkód" id="icolor_<?= $i ?>">
                                        </div>
                                    <?php $i++; ?>
                                @endforeach
                            @endif
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="color-select">
                            <div class="form-group">
                                <div class="input-group">
                                    <label for="background" class="input-group-addon">Háttér</label>
                                    <select class="form-control" id="background" name="background" required>
                                        <option disabled selected>Válassz egyet</option>
                                        @foreach($backgrounds as $background)
                                            <option @if($background==$current_background) selected @endif value="{{ $background->id }}" style="background:rgb({{ $background->red }}, {{ $background->green }}, {{ $background->blue }} );">{{ $background->name }}</option>
                                        @endforeach
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <input type="submit" value="Mentés" class="btn btn-primary">
                        <a href="javascript:history.back()" class="btn btn-default">Vissza</a>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-md-8" style="position:relative;">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Rajzolat</h3>
                </div>
                <div class="panel-body">
                    <svg style="@if($current_background!=null) background-color:rgb({{ $current_background->red }}, {{ $current_background->green }}, {{ $current_background->blue }} ); @endif" id="image" class="svg" viewBox="0 0 {{ $width }} {{ $height }}" preserveAspectRatio="none" style="margin:auto;">
                        @foreach($stitches as $id => $color)
                            @if($design->colors->count()==0)
                                <g id="color_{{ $id }}" style="stroke:rgb(0, 0, 0)">
                                    @else
                                        <g id="color_{{ $id }}" style="stroke:rgb({{ $design->colors->where('number',$id)->first()->red }}, {{ $design->colors->where('number',$id)->first()->green }}, {{ $design->colors->where('number',$id)->first()->blue }});">
                                            @endif
                                            @foreach($color as $stitch)
                                                <line x1="{{ $stitch[0][0]+abs($minx)+5 }}" x2="{{ $stitch[1][0]+abs($minx)+5 }}" y1="{{ $stitch[0][1]+abs($miny)+5 }}" y2="{{ $stitch[1][1]+abs($miny)+5 }}" style="stroke-width:1;"></line>
                                            @endforeach
                                        </g>
                                @endforeach
                    </svg>
                </div>
                <div class="panel-footer">

                </div>
            </div>

        </div>
    </div>

@endsection

@section('scripts')
    <script>
        var backgrounds = {
            @foreach($backgrounds as $background)
                '{{ $background->id }}': [ {{ $background->red }}, {{ $background->green }}, {{ $background->blue }}],
            @endforeach
        }
        var isa_rgb = {
            '0010':[255,255,250],
            '0015':[255,255,255],
            '0017':[248,255,255],
            '0020':[0,0,0],
            '0101':[255,255,232],
            '0108':[117,122,133],
            '0111':[84,97,94],
            '0112':[117,112,117],
            '0124':[240,243,243],
            '0131':[227,220,225],
            '0132':[40,69,76],
            '0142':[204,209,207],
            '0145':[220,227,235],
            '0150':[240,240,225],
            '0151':[235,232,220],
            '0152':[130,120,135],
            '0180':[255,245,238],
            '0182':[227,220,240],
            '0184':[248,238,253],
            '0221':[240,255,66],
            '0232':[217,255,120],
            '0250':[248,248,192],
            '0270':[255,255,227],
            '0310':[255,255,112],
            '0311':[255,238,15],
            '0345':[140,151,46],
            '0352':[197,232,102],
            '0442':[166,189,40],
            '0453':[133,174,76],
            '0463':[128,194,145],
            '0465':[38,64,0],
            '0501':[255,255,0],
            '0506':[255,238,35],
            '0520':[255,255,184],
            '0532':[238,230,122],
            '0542':[217,215,30],
            '0546':[204,215,0],
            '0552':[194,184,81],
            '0600':[255,245,38],
            '0605':[255,240,0],
            '0608':[255,240,12],
            '0630':[255,250,179],
            '0640':[255,250,145],
            '0651':[255,243,176],
            '0660':[253,253,202],
            '0670':[253,253,215],
            '0672':[230,240,189],
            '0700':[255,232,30],
            '0702':[248,227,5],
            '0704':[255,230,0],
            '0706':[255,207,0],
            '0713':[255,243,84],
            '0722':[197,181,128],
            '0747':[97,99,0],
            '0761':[255,255,207],
            '0776':[128,112,94],
            '0800':[255,211,5],
            '0811':[255,217,48],
            '0821':[245,212,35],
            '0822':[232,222,64],
            '0824':[238,217,12],
            '0832':[240,215,76],
            '0842':[202,174,33],
            '0851':[255,217,112],
            '0853':[145,133,33],
            '0861':[230,227,179],
            '0862':[204,197,156],
            '0870':[253,255,212],
            '0873':[202,197,143],
            '0874':[217,204,176],
            '0904':[248,190,0],
            '0922':[227,192,28],
            '0931':[209,174,0],
            '0932':[220,156,17],
            '0933':[102,51,0],
            '0934':[192,163,66],
            '0940':[230,202,0],
            '0941':[194,176,43],
            '0945':[97,74,33],
            '0970':[255,255,204],
            '1055':[84,58,30],
            '1060':[255,225,138],
            '1061':[220,184,110],
            '1102':[255,156,10],
            '1106':[255,76,0],
            '1114':[255,148,46],
            '1115':[204,115,10],
            '1120':[255,151,0],
            '1123':[192,174,94],
            '1134':[122,71,30],
            '1140':[255,245,168],
            '1141':[253,232,181],
            '1154':[143,79,0],
            '1172':[240,238,145],
            '1220':[255,153,43],
            '1300':[255,102,0],
            '1301':[232,66,0],
            '1304':[240,71,0],
            '1305':[255,79,0],
            '1306':[255,0,0],
            '1311':[207,87,5],
            '1312':[181,48,0],
            '1332':[230,117,40],
            '1334':[174,46,12],
            '1335':[184,53,17],
            '1342':[171,84,0],
            '1346':[56,0,0],
            '1351':[255,187,125],
            '1352':[255,166,92],
            '1355':[79,0,0],
            '1362':[255,212,89],
            '1366':[38,0,0],
            '1375':[43,35,48],
            '1430':[250,133,58],
            '1501':[255,0,0],
            '1514':[192,43,0],
            '1521':[243,120,84],
            '1532':[255,180,155],
            '1551':[255,204,174],
            '1565':[138,104,58],
            '1600':[227,122,74],
            '1725':[202,71,38],
            '1701':[232,51,0],
            '1703':[255,38,33],
            '1704':[255,30,12],
            '1755':[240,204,235],
            '1760':[240,204,192],
            '1761':[238,189,161],
            '1800':[217,2,17],
            '1805':[222,17,53],
            '1840':[255,158,128],
            '1860':[255,225,238],
            '1874':[84,66,69],
            '1876':[46,23,0],
            '1900':[215,0,43],
            '1902':[168,0,0],
            '1903':[222,0,5],
            '1904':[204,38,35],
            '1906':[174,0,10],
            '1911':[148,0,20],
            '1912':[71,0,5],
            '1913':[151,0,58],
            '1921':[171,76,76],
            '1940':[255,61,220],
            '1950':[255,0,174],
            '1972':[181,181,181],
            '2011':[153,33,58],
            '2022':[128,69,64],
            '2051':[215,145,186],
            '2101':[163,0,48],
            '2113':[130,2,46],
            '2115':[64,25,43],
            '2123':[64,20,20],
            '2152':[235,112,158],
            '2153':[255,163,197],
            '2155':[255,171,199],
            '2160':[253,215,245],
            '2166':[238,212,227],
            '2170':[248,222,235],
            '2171':[253,227,255],
            '2220':[248,81,122],
            '2222':[125,0,38],
            '2224':[133,40,43],
            '2241':[179,102,117],
            '2250':[253,215,250],
            '2300':[235,43,140],
            '2320':[212,46,156],
            '2333':[97,23,51],
            '2336':[48,2,15],
            '2363':[253,225,255],
            '2500':[122,0,84],
            '2504':[166,48,122],
            '2506':[102,0,43],
            '2520':[240,56,197],
            '2521':[225,33,181],
            '2550':[240,115,245],
            '2560':[255,145,240],
            '2576':[74,69,87],
            '2600':[151,71,168],
            '2640':[220,138,255],
            '2650':[225,192,248],
            '2655':[238,209,250],
            '2674':[166,181,179],
            '2711':[89,0,58],
            '2715':[71,0,25],
            '2720':[115,0,79],
            '2764':[209,128,194],
            '2810':[140,43,104],
            '2830':[186,156,253],
            '2900':[76,0,115],
            '2905':[145,28,125],
            '2910':[189,84,217],
            '2920':[171,102,163],
            '3040':[199,168,248],
            '3045':[207,153,255],
            '3062':[117,122,143],
            '3102':[0,0,79],
            '3110':[99,0,110],
            '3114':[58,0,84],
            '3210':[97,0,145],
            '3211':[158,79,156],
            '3241':[176,117,202],
            '3251':[199,156,217],
            '3323':[0,0,92],
            '3331':[197,171,240],
            '3333':[40,0,102],
            '3335':[69,5,133],
            '3344':[0,0,46],
            '3353':[43,10,115],
            '3355':[0,7,79],
            '3444':[10,51,66],
            '3522':[5,74,189],
            '3536':[94,15,84],
            '3541':[104,0,143],
            '3543':[71,0,145],
            '3544':[33,28,117],
            '3554':[0,0,10],
            '3600':[0,74,166],
            '3611':[12,58,140],
            '3612':[130,115,179],
            '3622':[0,53,158],
            '3640':[212,220,255],
            '3641':[94,135,238],
            '3650':[235,232,255],
            '3652':[161,204,248],
            '3732':[0,28,115],
            '3743':[10,76,89],
            '3750':[212,230,255],
            '3761':[215,230,253],
            '3770':[245,245,235],
            '3810':[84,112,212],
            '3815':[107,168,255],
            '3820':[166,209,255],
            '3840':[209,215,250],
            '3842':[48,120,138],
            '3900':[43,145,248],
            '3901':[20,161,255],
            '3902':[30,138,215],
            '3910':[171,230,227],
            '3951':[184,209,225],
            '3953':[71,110,135],
            '3962':[225,248,255],
            '3971':[232,232,230],
            '4010':[5,202,215],
            '4032':[81,156,174],
            '4033':[0,84,115],
            '4071':[232,248,255],
            '4073':[156,156,156],
            '4101':[104,230,232],
            '4103':[0,197,238],
            '4111':[51,235,240],
            '4113':[74,212,215],
            '4116':[12,168,179],
            '4133':[0,71,94],
            '4174':[0,35,46],
            '4220':[138,240,238],
            '4230':[168,243,240],
            '4240':[179,255,253],
            '4250':[215,255,250],
            '4410':[10,166,130],
            '4421':[0,199,181],
            '4423':[7,184,158],
            '4425':[12,194,140],
            '4430':[145,235,232],
            '4442':[12,148,135],
            '4452':[30,194,166],
            '4515':[0,81,81],
            '4531':[0,176,145],
            '4610':[25,207,128],
            '4620':[76,232,174],
            '4625':[48,184,130],
            '4643':[12,133,128],
            '4644':[0,99,92],
            '5005':[35,171,97],
            '5010':[0,225,168],
            '5050':[194,255,225],
            '5100':[17,194,84],
            '5101':[58,212,151],
            '5115':[138,238,176],
            '5210':[30,235,110],
            '5220':[168,255,204],
            '5230':[120,255,186],
            '5233':[2,174,110],
            '5324':[0,115,46],
            '5326':[0,128,33],
            '5335':[0,92,17],
            '5374':[0,81,48],
            '5411':[0,207,0],
            '5415':[0,107,78],
            '5422':[0,179,0],
            '5500':[66,255,0],
            '5510':[33,245,35],
            '5513':[46,209,0],
            '5515':[7,227,0],
            '5531':[89,230,64],
            '5552':[171,217,161],
            '5555':[0,94,0],
            '5610':[143,245,51],
            '5613':[76,250,43],
            '5633':[25,171,25],
            '5643':[15,145,0],
            '5650':[181,255,138],
            '5664':[120,194,148],
            '5822':[179,227,107],
            '5833':[102,215,33],
            '5866':[0,51,0],
            '5912':[140,255,66],
            '5933':[46,171,0],
            '5934':[53,130,0],
            '5940':[145,255,33],
            '5944':[25,104,17],
            '6010':[215,235,0],
            '6051':[168,255,120],
            '6133':[153,209,71],
            '6156':[30,53,0]
        };
        var sulky_isa = {
            '505':'3444',
            '520':'0870',
            '521':'1032',
            '523':'0821',
            '524':'3344',
            '525':'5353',
            '526':'3522',
            '534':'2113',
            '538':'5335',
            '561':'1902',
            '567':'0811',
            '568':'0922',
            '569':'5515',
            '571':'5010',
            '572':'3335',
            '580':'5542',
            '610':'7369',
            '621':'1311',
            '622':'0713',
            '630':'5934',
            '640':'4610',
            '1001':'0015',
            '1002':'0010',
            '1005':'0020',
            '1011':'0142',
            '1017':'1060',
            '1019':'1351',
            '1022':'0270',
            '1023':'0600',
            '1024':'0702',
            '1025':'0821',
            '1028':'3641',
            '1029':'3820',
            '1030':'3331',
            '1031':'3045',
            '1032':'2830',
            '1034':'1921',
            '1035':'2123',
            '1037':'1800',
            '1039':'1900',
            '1040':'0152',
            '1042':'3543',
            '1043':'3355',
            '1044':'3354',
            '1046':'5020',
            '1049':'5531',
            '1051':'5415',
            '1054':'1140',
            '1055':'0851',
            '1056':'0935',
            '1057':'0933',
            '1058':'1355',
            '1059':'1876',
            '1061':'0260',
            '1064':'2170',
            '1065':'1200',
            '1066':'0520',
            '1067':'0230',
            '1070':'8543',
            '1071':'0670',
            '1074':'3951',
            '1076':'3611',
            '1078':'1304',
            '1079':'5411',
            '1080':'2640',
            '1081':'1725',
            '1086':'0670',
            '1090':'4531',
            '1094':'4103',
            '1095':'4111',
            '1096':'4116',
            '1100':'5650',
            '1101':'5411',
            '1103':'5866',
            '1104':'6051',
            '1108':'2155',
            '1109':'2520',
            '1112':'3110',
            '1113':'1860',
            '1115':'2250',
            '1119':'2241',
            '1120':'2170',
            '1121':'2250',
            '1122':'2905',
            '1124':'0506',
            '1126':'1032',
            '1127':'0761',
            '1128':'0853',
            '1131':'1776',
            '1134':'7240',
            '1135':'0630',
            '1137':'0702',
            '1147':'1800',
            '1148':'1840',
            '1149':'1172',
            '1151':'4250',
            '1154':'1753',
            '1156':'6133',
            '1158':'1355',
            '1159':'0542',
            '1162':'4515',
            '1166':'0110',
            '1167':'0630',
            '1168':'1102',
            '1169':'1912',
            '1170':'0925',
            '1172':'3842',
            '1173':'0354',
            '1174':'5555',
            '1175':'5944',
            '1177':'5832',
            '1179':'0945',
            '1180':'0862',
            '1181':'1335',
            '1182':'3344',
            '1183':'1776',
            '1184':'1304',
            '1185':'0600',
            '1186':'1346',
            '1187':'0600',
            '1188':'1753',
            '1189':'2336',
            '1190':'2241',
            '1192':'2500',
            '1193':'3030',
            '1194':'2920',
            '1195':'3114',
            '1196':'3820',
            '1197':'3353',
            '1199':'3244',
            '1200':'3323',
            '1201':'3830',
            '1202':'4133',
            '1203':'4250',
            '1204':'4250',
            '1206':'4643',
            '1208':'5233',
            '1210':'0465',
            '1211':'0463',
            '1216':'1332',
            '1217':'1344',
            '1218':'0151',
            '1219':'2564',
            '1220':'0111',
            '1222':'3840',
            '1223':'3951',
            '1224':'2560',
            '1225':'2160',
            '1226':'3332',
            '1227':'0442',
            '1229':'0672',
            '1230':'5005',
            '1231':'2300',
            '1233':'4644',
            '1234':'4174',
            '1235':'3110',
            '1238':'1200',
            '1240':'0112',
            '1241':'0132',
            '1243':'0221',
            '1245':'0442',
            '1247':'1366',
            '1248':'3962',
            '1249':'3910',
            '1251':'4113',
            '1252':'4103',
            '1254':'3030',
            '1255':'2810',
            '1256':'2532',
            '1258':'1362',
            '1259':'1430',
            '1261':'0600',
            '1262':'0546',
            '1263':'1514',
            '1265':'0833',
            '1267':'1055',
            '1269':'0862',
            '1271':'5353',
            '1273':'5866',
            '1275':'5450',
            '1277':'5513',
            '1278':'5613',
            '1279':'5440',
            '1280':'5230',
            '1281':'5101',
            '1282':'5100',
            '1284':'3842',
            '1285':'4643',
            '1287':'5644',
            '1290':'3900',
            '1291':'3953',
            '1292':'3652',
            '1293':'3323',
            '1294':'7088',
            '1297':'2864',
            '1299':'3536',
            '1300':'2711',
            '1301':'3110',
            '1302':'3210',
            '1303':'1840',
            '1305':'4752',
            '1308':'2302',
            '1309':'2333',
            '1310':'2210',
            '1311':'2011',
            '1312':'2123',
            '1314':'1300',
            '1315':'1304',
            '1317':'1701',
            '1319':'1800',
            '1321':'0672',
            '1323':'0576',
            '1328':'0108',
            '1329':'0131',
            '1331':'5650',
            '1332':'5832',
            '1334':'0542',
            '1503':'5115',
            '1508':'0463',
            '1511':'2320',
            '1513':'4423',
            '1517':'5005',
            '1533':'2300',
            '1534':'3901',
            '1535':'3612',
            '1536':'5374'
        };

        var background = $('#background');


        $(background).on('load paste keyup click change', function(){
            console.log(backgrounds[background.val()]);
            $('#image').css('background-color','rgb(' + backgrounds[background.val()][0] +', ' + backgrounds[background.val()][1] + ', ' + backgrounds[background.val()][2] + ')');
        });


        @for($i = 0; $i<$color_count; $i++)

            $('#icolor_{{ $i }}').focusout(function(){
                console.log('blur');
                @for($j = 0; $j<$color_count; $j++)
                    code = $('#icolor_{{ $j }}').val();
                if($('input[name=color_isa_{{ $j }}]:checked').val()==='isa'){
                    rgb = isa_rgb[code];
                }else if($('input[name=color_isa_{{ $j }}]:checked').val()==='sulky'){
                    isa = sulky_isa[code];
                    rgb = isa_rgb[isa];
                }else{
                    rgb = [0,0,0];
                }
                if(rgb===undefined){
                    rgb= [0,0,0];
                }
                $('#color_{{ $j }}').attr('style','stroke:rgb(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ');');
                @endfor
            });
            $('#icolor_{{ $i }}, #color_isa_{{ $i }}, #color_sulky_{{ $i }}').on('focus paste click keyup', function(){
                console.log('focus');
                code = $('#icolor_{{ $i }}').val();
                console.log(code);
                if($('input[name=color_isa_{{ $i }}]:checked').val()==='isa'){
                    rgb = isa_rgb[code];
                }else if($('input[name=color_isa_{{ $i }}]:checked').val()==='sulky'){
                    isa = sulky_isa[code];
                    rgb = isa_rgb[isa];
                }else{
                    rgb = [0,0,0];
                }
                if(rgb===undefined){
                    rgb=[0,0,0];
                }
                $('#r_{{ $i }}').val(rgb[0]);
                $('#g_{{ $i }}').val(rgb[1]);
                $('#b_{{ $i }}').val(rgb[2]);
                $('#color_{{ $i }}').attr('style','stroke:rgb(' + rgb[0] + ',' + rgb[1] + ',' + rgb[2] + ')');
                @for($j = 0; $j<$color_count; $j++)
                    @if($j!=$i)
                        $('#color_{{ $j }}').attr('style','stroke:rgb(127,127,127)');
                    @endif
                @endfor
            });

        @endfor
    </script>
@endsection
